**Авторизация:**
```JSON
Rquest 1: {
  "cmd": {
    "name":"auth",
    "data": {
      "login": "< user name >",
      "pswd": "< password >"
    }
  }
}
```
```JSON
Rquest 2: {
  "cmd": {
    "name":"auth",
    "data": {
      "token": "< Токен пользователя, полученный при авторизации. >"
    }
  }
}
```
```JSON
Responce: {
  "resp": {
    "name":"auth",
    "status":"< ok | err >",
    "token":"< идентификатор пользователя сервиса >",
    "user_info": {
         "person": "< Имя Фамилия и т.д. >",
         "desc": "< Информация о пользователе сервиса >"
    },
    "desc":"<описание, при ок — этого поля не будет>"
  }
}
```

**Выход из сервиса:**
```JSON
Rquest 1: {
  "cmd": {
    "name":"logout",
    "data": {
      "token":"< идентификатор пользователя сервиса >"
    }
  }
}
```
```JSON
Responce: {
  "resp": {
    "name":"auth",
    "status":"< ok | err >",
    "desc":"< описание, при ок — этого поля не будет >"
  }
}
```

```JSON
**Получение уникальных адресов:**
Rquest 1: {
  "cmd": {
    "name":"get_uniq_addrs",
    "data": {
       "token":"< идентификатор пользователя сервиса >",
       "filter": "< строка фильтра, может отсутствовать >"
    }
  }
}
```
```JSON
Responce: {
  "resp": {
    "name":"auth",
    "status":"< ok | err >",
    "uniq_addrs": [ "< Json c описанием адреса >" ],
    "desc":"< описание, при ок — этого поля не будет >"
  }
}
```
```JSON
Описание адреса: {
   "geo": [ "< latitude >", "< longitute >" ],
   "address": [ "< строка адреса >" ],
   "device_count": "< количество устройств для данного адреса >"
}
```

**Запрос списка устройств:**
```JSON
Rquest 1: {
  "cmd": {
    "name":"get_devs",
    "data": {
      "token":"< идентификатор пользователя сервиса >",
      "skip":"< количество пропускаемых записей в списке найденных устройств >",
      "num":"< количество возвращаемых устройств >",
      "filter":"<любая строка, которой могут соответствовать строки в БД >",
      "sort": {
        "field": "< название поля по которому сортируется. >",
        "direction": "< направление сортировки [ asc | desc ] >"
      }
    }
  }
}
```
```JSON
Rquest 2: {
  "cmd": {
    "name":"get_devs",
    "data": {
      "token":"< идентификатор пользователя сервиса >",
      "skip":"< количество пропускаемых записей в списке найденных устройств >",
      "num":"< количество возвращаемых устройств >",
      "geo":[ "< longitude >", "< latitude >" ],
      "radius": "< радиус поиска >"
    }
  }
}
```
```JSON
Rquest 3: {
  "cmd": {
    "name":"get_devs",
    "data": {
      "token":"< идентификатор пользователя сервиса >",
      "skip":"< количество пропускаемых записей в списке найденных устройств >",
      "num":"< количество возвращаемых устройств >",
      "geo_poly": [ "< x >", "< y >", "< w >", "< h >" ],
    }
  }
}
```
```JSON
Rquest 4: {
  "cmd": {
    "name":"get_devs",
    "data": {
      "token":"< идентификатор пользователя сервиса >",
      "skip":"< количество пропускаемых записей в списке найденных устройств >",
      "num":"< количество возвращаемых устройств >",
      "date_time": "< Дата time_t, по которой необходимо найти устройства >",
      "date_type": "< start_time (время запуска устройства) | update_time (время последнего обновления) >"
    }
  }
}
```
```JSON
Responce: {
  "resp": {
    "name": "get_devs",
    "status": "< ok | err >",
    "count": "< общее количество записей в таблице устройств >",
    "data": [ "< json устройства при err — этого поля не будет >" ],
    "desc": "< описание, при ок этого поля не будет >"
  }
}
```
```JSON
Json с описание устройства: {
  "dev_id":"<идентификатор устройства, (уникален) >",
  "coll":"< адрес расположения устройства — более подробный чем для объекта >",
  "user":"< владелец устройства >",
  "geo": [ "< longitude >", "< latitude >" ],
  "start_time":"< время запуска устройства >",
  "update_time":"< время последнего подключения к серверу >",
  "power_type":"< тип питания устройства >",
  "voltage":"< текущее напряжение батареи автономного питания >",
  "voltage_perc":"< значение от 0 до 100 >",
  "desc":"< некоторое описание устройтсва >",
  "status":"< active | not_active >",
  "counters":[
    {
      "type":"<none | любая не пустая строка (при none остальных полей в этой части json может не быть) >",
      "count":"<количество обработанных импульсов>",
      "unit":"<единица измерения>",
      "unit_type":"<количество единиц измерения на импульс>",
      "unit_count":"<количество кубометров>",
      "serial":"<серийный монер счётчика>",
      "verify_date":"<дата последней поверки счётчика>",
      "desc":"<некоторое описание, например какая вода измерятеся>"
    },
    "<таких записей всего 4, первая запись для счётчика устройства №1, вторая для №2 и т.д.  >"
  ]
}
```

**Активация / деактивация устройства:**
```JSON
Rquest: {
  "cmd": {
    "name": "set_dev_status",
    "data": {
      "token": "< идентификатор пользователя сервиса >",
      "dev_id": "< идентификатор устройства, (уникален) >",
      "status": "< activate | deactivate >"
    }
  }
}
```
```JSON
Responce: {
  "resp": {
    "name": "set_dev_status",
    "status": "< ok | err >",
    "desc": "< описание, при ок этого поля не будет >"
  }
}
```

**Запрос списка событий:**
```JSON
Rquest 1: {
  "cmd": {
    "name": "get_events",
    "data": {
      "token": "< идентификатор пользователя сервиса >",
      "skip": "< количество пропускаемых записей в найденном списке >",
      "num": "< количество возвращаемых событий >",
      "dev_id": "< идентификатор устройства, (уникален) >",
      "filter": "< любая строка, которой могут соответствовать строки в БД >",
      "sort": {
        "field": "< название поля по которому сортируется. >",
        "direction": "< направление сортировки [ asc | desc ] >"
      }
    }
  }
}
```
```JSON
Rquest 2: {
  "cmd": {
    "name": "get_events",
    "data": {
      "token": "< идентификатор пользователя сервиса >",
      "skip": "< количество пропускаемых записей в списке найденных устройств >",
      "num": "< количество возвращаемых устройств >",
      "geo_poly": [ "< x >", "< y >", "< w >", "< h >" ],
    }
  }
}
```
```JSON
Rquest 3: {
  "cmd": {
    "name":"get_devs",
    "data": {
      "token": "< идентификатор пользователя сервиса >",
      "skip": "< количество пропускаемых записей в списке найденных устройств >",
      "num": "< количество возвращаемых устройств >",
      "date_time": "< Дата события >"
    }
  }
}
```
```JSON
Responce: {
  "resp": {
    "name": "get_events",
    "status": "< ok | err >",
    "count": "< общее количество записей в таблице событий >",
    "data":["< json события, при err — этого поля не будет >" ],
    "desc": "< описание, при ок этого поля не будет >"
  }
}
```
```JSON
Json описывающий событие: {
  "ev_id": "< уникальный идентийикатор >",
  "dev_id": "< уникальный идентийикатор устройсва на которов произошло событие >",
  "coll": "< адрес где произошло событие >",
  "user": "< владелец устройства, для которого произошло событие >",
  "geo": "< геопозиция (пустая, если не указана) >",
  "time": "< время события >",
  "priority": "< тип питания устройства >",
  "desc": "< описание события >"
}
```

**Команда на формирование отчёта.**
```JSON
Rquest: {
  "cmd": {
    "name": "get_devices_report",
    "data": {
      "token": "< идентификатор пользователя сервиса >",
      "coll": "< адрес для которого необходимо сформировать отчёт >",
      "encoding": "< название кодировки в которой необходимо представить отчёт >"
    }
  }
}
```
```JSON
Responce: {
  "resp": {
    "name": "get_devices_report",
    "status": "< ok | err >",
    "progress": "< текущий прогресс генерации >",
    "desc": "< описание, при ок этого поля не будет >"
  }
}
```
```JSON
Responce: {
  "resp": {
    "name": "get_devices_report",
    "status":"< ok | err >",
    "report_url": "< url с файлом отчёта >",
    "desc": "< описание, при ок этого поля не будет >"
  }
}
```

**Команда на формирование отчёта.**
```JSON
Rquest: {
  "cmd": {
    "name": "get_events_report",
    "data": {
      "token": "< идентификатор пользователя сервиса >",
      "coll": "< адрес для которого необходимо сформировать отчёт >",
      "encoding": "< название кодировки в которой необходимо представить отчёт >"
    }
  }
}
```
```JSON
Responce: {
  "resp": {
    "name": "get_events_report",
    "status": "< ok | err >",
    "progress": "< текущий прогресс генерации >",
    "desc": "< описание, при ок этого поля не будет >"
  }
}
```
```JSON
Responce: {
  "resp": {
    "name": "get_events_report",
    "status": "< ok | err >",
    "report_url": "< url с файлом отчёта >",
    "desc": "< описание, при ок этого поля не будет >"
  }
}
```

**Команда возвращает колечество устройств с критическим событием.**
```JSON
Rquest: {
  "cmd": {
    "name": "get_critical",
    "data": {
      "filter": "< любая строка, которой могут соответствовать строки в БД. dev_id - должен отсутсвовать >",
      "dev_id": "< Идентификатор устройства, для которого требуется число событий. filter - должен отсутсвовать >",
      "token": "< идентификатор пользователя сервиса >"
    }
  }
}
```
```JSON
Responce: {
  "resp": {
    "name": "get_events_report",
    "status": "< ok | err >",
    "num": "< количество анйденных вхождений >",
    "desc": "< описание, при ок этого поля не будет >"
  }
}
```

**Команда возвращает описание устройства по идентификатору.**
```JSON
Rquest: {
  "cmd": {
    "name": "get_device",
    "data": {
      "dev_id": "< идентификатор устройства, (уникален) >",
      "token": "< идентификатор пользователя сервиса >"
    }
  }
}
```
```JSON
Responce: {
  "resp": {
    "name": "get_device",
    "status": "< ok | err >",
    "device": "< полный JSON устройства. >",
    "desc": "<описание, при ок этого поля не будет>"
  }
}
```
